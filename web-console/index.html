<!doctype html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Taonix æ§åˆ¶å° v3.9.0</title>
    <style>
      :root {
        --primary: #3b82f6;
        --bg: #0f172a;
        --card-bg: #1e293b;
        --text: #e2e8f0;
        --text-muted: #94a3b8;
        --border: #334155;
        --success: #22c55e;
        --warning: #f59e0b;
        --danger: #ef4444;
        --handover: #a855f7;
      }
      * { box-sizing: border-box; margin: 0; padding: 0; }
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        background: var(--bg);
        color: var(--text);
        min-height: 100vh;
        overflow-x: hidden;
      }
      .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
      header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px 0;
        border-bottom: 1px solid var(--border);
        margin-bottom: 20px;
      }
      h1 { font-size: 24px; display: flex; align-items: center; gap: 10px; }
      .badge { background: var(--primary); padding: 4px 12px; border-radius: 12px; font-size: 12px; }
      
      .main-grid {
        display: grid;
        grid-template-columns: 300px 1fr 350px;
        gap: 20px;
      }
      
      .card {
        background: var(--card-bg);
        border-radius: 12px;
        padding: 20px;
        border: 1px solid var(--border);
        display: flex;
        flex-direction: column;
        margin-bottom: 20px;
      }
      .card h2 { font-size: 16px; margin-bottom: 15px; color: var(--text-muted); display: flex; align-items: center; gap: 8px; }
      
      /* Agent List */
      .agent-list { display: flex; flex-direction: column; gap: 10px; }
      .agent {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px;
        background: var(--bg);
        border-radius: 8px;
        border: 1px solid transparent;
        transition: all 0.3s;
      }
      .agent:hover { border-color: var(--primary); }
      .agent-name { font-weight: 500; font-size: 14px; }
      .agent-status { font-size: 11px; padding: 2px 6px; border-radius: 4px; background: var(--success); color: #fff; }

      /* Goal Progress */
      .goal-item { margin-bottom: 15px; background: var(--bg); padding: 15px; border-radius: 8px; }
      .goal-header { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 14px; }
      .progress-container { height: 8px; background: #334155; border-radius: 4px; overflow: hidden; }
      .progress-bar { height: 100%; background: var(--primary); border-radius: 4px; transition: width 0.5s ease-in-out; }
      .goal-meta { font-size: 11px; color: var(--text-muted); margin-top: 5px; }

      /* Activity Log */
      .log-container { flex: 1; overflow-y: auto; max-height: 400px; }
      .log-entry {
        padding: 12px;
        border-bottom: 1px solid var(--border);
        font-size: 13px;
        animation: fadeIn 0.3s ease-out;
      }
      @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
      .log-header { display: flex; justify-content: space-between; margin-bottom: 5px; }
      .log-time { color: var(--text-muted); font-family: monospace; }
      .log-method { font-size: 10px; padding: 1px 4px; border-radius: 3px; background: #475569; }
      .log-intent { font-weight: bold; color: #60a5fa; }

      /* Timeline */
      .timeline { padding: 10px; border-left: 2px solid var(--border); margin-left: 10px; }
      .timeline-item { position: relative; padding-bottom: 20px; padding-left: 20px; }
      .timeline-item::before {
        content: ""; position: absolute; left: -21px; top: 5px;
        width: 10px; height: 10px; border-radius: 50%; background: var(--primary);
      }
      .timeline-agent { font-weight: bold; color: var(--primary); font-size: 12px; }
      .timeline-action { font-size: 11px; color: var(--text-muted); }
      .timeline-details { font-size: 12px; background: var(--bg); padding: 5px; border-radius: 4px; margin-top: 5px; }

      .status-dot { display: inline-block; width: 8px; height: 8px; border-radius: 50%; background: var(--success); margin-right: 5px; }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>ğŸš€ Taonix <span class="badge">v3.9.0</span></h1>
        <div><span class="status-dot"></span>ç³»çµ±é‹è¡Œä¸­</div>
      </header>

      <div class="main-grid">
        <!-- Left: Agents -->
        <div>
          <div class="card">
            <h2>ğŸ‘¥ å°ˆå®¶ Agent åœ˜éšŠ</h2>
            <div class="agent-list" id="agentList">
              <div class="agent"><span class="agent-name">ğŸ§­ Explorer (æ»„æºŸ)</span><span class="agent-status">å°±ç·’</span></div>
              <div class="agent"><span class="agent-name">ğŸ’» Coder (é‘„ç„°)</span><span class="agent-status">å°±ç·’</span></div>
              <div class="agent"><span class="agent-name">ğŸ”® Oracle (æ˜é¡)</span><span class="agent-status">å°±ç·’</span></div>
              <div class="agent"><span class="agent-name">ğŸ›¡ï¸ Reviewer (å®ˆé—•)</span><span class="agent-status">å°±ç·’</span></div>
              <div class="agent"><span class="agent-name">ğŸ¨ Designer (å¤©å·¥)</span><span class="agent-status">å°±ç·’</span></div>
              <div class="agent"><span class="agent-name">ğŸ“¦ Product (é´»åœ–)</span><span class="agent-status">å°±ç·’</span></div>
              <div class="agent"><span class="agent-name">ğŸ§ª Tester (è©¦ç…‰)</span><span class="agent-status">å°±ç·’</span></div>
              <div class="agent"><span class="agent-name">ğŸ¤– Assistant (åŠ©ç†)</span><span class="agent-status">å°±ç·’</span></div>
            </div>
          </div>
          <div class="card">
            <h2>ğŸ¯ é•·æœŸè¦åŠƒé€²åº¦</h2>
            <div id="goalList">
              <div style="padding: 20px; text-align: center; color: var(--text-muted);">è¼‰å…¥è¦åŠƒä¸­...</div>
            </div>
          </div>
        </div>

        <!-- Middle: Activity & Timeline -->
        <div>
          <div class="card">
            <h2>â›“ï¸ å”ä½œæ™‚é–“è»¸ (Collaboration Timeline)</h2>
            <div class="log-container" id="collabTimeline" style="max-height: 500px;">
              <div style="padding: 20px; text-align: center; color: var(--text-muted);">ç­‰å¾…å”ä½œæ•¸æ“š...</div>
            </div>
          </div>
          <div class="card">
            <h2>ğŸ“ MCP è·¯ç”±å‹•æ…‹</h2>
            <div class="log-container" id="mcpLogs">
              <div style="padding: 20px; text-align: center; color: var(--text-muted);">ç­‰å¾…æ´»å‹•æ•¸æ“š...</div>
            </div>
          </div>
        </div>

        <!-- Right: Status -->
        <div class="card">
          <h2>ğŸ“Š ç³»çµ±çµ±è¨ˆ</h2>
          <div id="sysStats" style="font-size: 13px;">
            <div style="margin-bottom: 10px;">æœ€å¾Œæ›´æ–°: <span id="lastUpdate">--:--:--</span></div>
            <div style="margin-bottom: 10px;">æ´»èºç›®æ¨™: <span id="activeGoals">0</span></div>
            <div style="margin-bottom: 10px;">å”ä½œäº‹ä»¶: <span id="collabEvents">0</span></div>
          </div>
        </div>
      </div>
    </div>

    <script>
      async function fetchData() {
        try {
          // Fetch Goals
          const goalsRes = await fetch('/.data/goals.json');
          if (goalsRes.ok) {
            const data = await goalsRes.json();
            const goals = Object.values(data.goals || {}).sort((a, b) => new Date(b.created) - new Date(a.created));
            renderGoals(goals);
            document.getElementById('activeGoals').innerText = goals.filter(g => g.status === 'in_progress').length;
          }

          // Fetch MCP Logs
          const logsRes = await fetch('/.data/mcp_logs.json');
          if (logsRes.ok) {
            const logs = await logsRes.json();
            renderLogs(logs);
          }

          // Fetch Collaboration Logs
          const collabRes = await fetch('/.data/collaboration_logs.json');
          if (collabRes.ok) {
            const collabLogs = await collabRes.json();
            renderTimeline(collabLogs);
            document.getElementById('collabEvents').innerText = collabLogs.length;
          }
          
          document.getElementById('lastUpdate').innerText = new Date().toLocaleTimeString();
        } catch (e) {
          console.error('Fetch error:', e);
        }
      }

      function renderGoals(goals) {
        const container = document.getElementById('goalList');
        if (goals.length === 0) {
          container.innerHTML = '<div style="text-align:center; padding:20px; color:var(--text-muted)">ç„¡é€²è¡Œä¸­ç›®æ¨™</div>';
          return;
        }
        
        container.innerHTML = goals.map(g => `
          <div class="goal-item">
            <div class="goal-header">
              <span>${g.title.substring(0, 30)}${g.title.length > 30 ? '...' : ''}</span>
              <span style="color: var(--primary)">${g.progress}%</span>
            </div>
            <div class="progress-container">
              <div class="progress-bar" style="width: ${g.progress}%"></div>
            </div>
            <div class="goal-meta">
              ç‹€æ…‹: ${g.status} | æˆªæ­¢: ${new Date(g.deadline).toLocaleDateString()}
            </div>
          </div>
        `).join('');
      }

      function renderLogs(logs) {
        const container = document.getElementById('mcpLogs');
        if (logs.length === 0) {
          container.innerHTML = '<div style="text-align:center; padding:20px; color:var(--text-muted)">æš«ç„¡æ´»å‹•</div>';
          return;
        }
        container.innerHTML = logs.map(l => `
          <div class="log-entry">
            <div class="log-header">
              <span class="log-time">${new Date(l.timestamp).toLocaleTimeString()}</span>
              <span class="log-method">${l.routing_method || 'keyword'}</span>
            </div>
            <div class="log-intent">${l.intent}</div>
            <div style="font-size: 11px; color: var(--warning)">â” ${l.routed_to}</div>
          </div>
        `).join('');
      }

      function renderTimeline(logs) {
        const container = document.getElementById('collabTimeline');
        if (logs.length === 0) {
          container.innerHTML = '<div style="text-align:center; padding:20px; color:var(--text-muted)">æš«ç„¡å”ä½œè»Œè·¡</div>';
          return;
        }
        container.innerHTML = '<div class="timeline">' + logs.map(l => `
          <div class="timeline-item">
            <div class="timeline-agent">${l.agent.toUpperCase()}</div>
            <div class="timeline-action">${l.action} - ${new Date(l.timestamp).toLocaleTimeString()}</div>
            <div class="timeline-details">
              ${l.details.intent || ''} ${l.details.to ? 'â” ' + l.details.to : ''}
            </div>
          </div>
        `).join('') + '</div>';
      }

      // Initial fetch and poll
      fetchData();
      setInterval(fetchData, 3000);
    </script>
  </body>
</html>
